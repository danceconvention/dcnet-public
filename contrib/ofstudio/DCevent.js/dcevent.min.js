/**
     * DCEvent.js - Browser-side implementation of danceconvention.net API
     *
     * http://danceconvention.net
     * https://github.com/danceconvention/dcnet-public
     * Source: https://github.com/ofstudio/DCevent.js
     *
     * Compatibility:
     *
     *  All modern browsers including Internet Explorer 10 and up
     * (Internet Explorer 8 and 9 will work only if your site runs over https
     * due to restrictions in CORS implementation in IE8 and IE9)
     *
     * Copyright (c) 2014 Oleg Fomin <ofstudio@gmail.com>
     * Released under the MIT license
     *
     * @author Oleg Fomin <ofstudio@gmail.com>
     * @version 0.0.1
     */

!function(){var t,n,e,r,o,i;!function(a,s,u){"use strict";t=function(){function t(t){for(var n;i[t].length;)n=i[t].shift(),"function"==typeof n&&n.apply(n,a)}function n(n){return function(e){return i[n].push(e),"pending"!==o&&(o===n&&t(n),"always"===n&&t("always")),r()}}function e(n){return function(){"pending"===o&&(a=Array.prototype.slice.call(arguments,0),o=n,t(n),t("always"))}}var r,o="pending",i={resolved:[],rejected:[],always:[]},a=[];return r=function(){return{done:n("resolved"),fail:n("rejected"),always:n("always")}},{promise:r,resolve:e("resolved"),reject:e("rejected")}},n=function(){var t,n=/MSIE (\d+\.\d+);/.test(navigator.userAgent),e=!!navigator.userAgent.match(/Trident\/7.0/),r=navigator.userAgent.indexOf("rv:11.0");return n&&(t=Number(RegExp.$1)),-1!==navigator.appVersion.indexOf("MSIE 10")&&(t=10),e&&-1!==r&&(t=11),t},e=function(t,e,r){var o,i=n(),s=function(t){if("function"!=typeof r)throw new Error("loadJSON: "+t);r(t)},c=function(t){"function"==typeof e&&e(t)};i&&10>i?(o=new a.XDomainRequest,o.onerror=function(){s("XDomainRequest error")},o.onload=function(){c(a.JSON.parse(o.responseText))},o.open("GET",t),o.send()):a.XMLHttpRequest!==u?(o=new a.XMLHttpRequest,o.open("GET",t,!0),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?c(a.JSON.parse(o.responseText)):s(o.status))},o.send()):s("No appropriate method for cross-domain request!")},r=function(t,n){return function(e,r){var o,i,a,s;return o={contestSignups:{},eventSignups:u,eventContests:u},i=function(){var o=t(),i=r+"eventinfo/"+e.toString()+"/contests";return n(i,function(t){for(var n={},e=t.length;e--;)n[t[e].id]=n[t[e].name]=t[e];o.resolve(n)},function(t){o.reject("Unable to load contests list!\nFailed to load "+i+"\n"+t)}),o.promise()},a=function(e,a){var s=t();return o.eventContests===u&&(o.eventContests=i()),o.eventContests.done(function(t){if(t[e]===u)return void s.reject("No such contest: "+e);var o=r+"eventinfo/signups/"+t[e].id+"/"+a;n(o,function(t){for(var n,e=t.length;e--;)t[e].city=t[e].cityAndState,t[e].partnerName&&(n=t[e].partnerName.split(" "),t[e].parnterFirstName=n[0],t[e].parnterLastName=n[1]||"");s.resolve(t)},function(t){s.reject("Unable to load contest signups!\nFailed to load "+o+"\n"+t)})}),o.eventContests.fail(function(t){s.reject(t)}),s.promise()},s=function(){var o=t(),i=r+"eventinfo/"+e.toString()+"/signups";return n(i,function(t){for(var n,e=t.length;e--;)n=t[e].participantName.split(" "),t[e].firstName=n[0],t[e].lastName=n[1]||"",t[e].city=t[e].cityAndState;o.resolve(t)},function(t){o.reject("Unable to load event signups!\nFailed to load "+i+"\n"+t)}),o.promise()},{getContestSignups:function(t,n,e){o.contestSignups[t]===u&&(o.contestSignups[t]={}),o.contestSignups[t][n]===u&&(o.contestSignups[t][n]=a(t,n)),o.contestSignups[t][n].done(function(t){"function"==typeof e&&e(t)}),o.contestSignups[t][n].fail(function(t){throw new Error("API Error: can't get contest signups!\n "+t)})},getEventSignups:function(t){o.eventSignups===u&&(o.eventSignups=s()),o.eventSignups.done(function(n){"function"==typeof t&&t(n)}),o.eventSignups.fail(function(t){throw new Error("API Error: can't get event signups!\n"+t)})}}}}(t,e),o=function(t){for(var n="",e=[],r=t.length;r--;)e.unshift(t[r].lastName+" "+t[r].firstName),t[r].city&&(e[0]=e[0]+", "+t[r].city),(t[r].parnterLastName||t[r].parnterFirstName)&&(e[0]=e[0]+" â€“ "+t[r].parnterLastName+" "+t[r].parnterFirstName,t[r].partnerCity&&(e[0]=e[0]+", "+t[r].partnerCity));return e.length&&(n="<ol>\n<li>"+e.join("</li>\n<li>")+"</li>\n</ol>"),n},i=function(t,n){var e,r,o,i={},c="https://danceconvention.net/eventdirector/rest/",p=s.querySelector("script[data-dcevent-api]"),f=s.querySelectorAll("[data-dcevent]"),l=f.length,g=function(t){return function(e){t.innerHTML=n(e)}};for(p&&(c=p.getAttribute("data-dcevent-api"));l--;)e=f[l].getAttribute("data-dcevent"),e&&(r=f[l].getAttribute("data-contest"),o=f[l].getAttribute("data-select"),i[e]||(i[e]=t(e,c)),r&&o&&i[e].getContestSignups(r,o,g(f[l])),r||"signups"!==o||i[e].getEventSignups(g(f[l])));a.DCevent={api:function(n,e){return e===u&&(e=c),t(n,e)},version:"0.0.1",apiBaseUrl:c}}(r,o)}(window,document)}();