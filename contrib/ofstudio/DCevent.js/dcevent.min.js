/**
     * DCEvent.js - Browser-side implementation of danceconvention.net API
     *
     * http://danceconvention.net
     * https://github.com/danceconvention/dcnet-public
     * Source: https://github.com/ofstudio/DCevent.js
     *
     * Compatibility:
     *
     *  All modern browsers including Internet Explorer 10 and up
     * (Internet Explorer 8 and 9 will work only if your site runs over https
     * due to restrictions in CORS implementation in IE8 and IE9)
     *
     * Copyright (c) 2014 Oleg Fomin <ofstudio@gmail.com>
     * Released under the MIT license
     *
     * @author Oleg Fomin <ofstudio@gmail.com>
     * @version 0.0.2
     */

!function(){var defer,ieVersion,loadJson,dcApi,formatData,dcevent;!function(window,document,undefined){"use strict";defer=function(){function t(t){for(var e;i[t].length;)e=i[t].shift(),"function"==typeof e&&e.apply(e,a)}function e(e){return function(n){return i[e].push(n),"pending"!==r&&(r===e&&t(e),"always"===e&&t("always")),o()}}function n(e){return function(){"pending"===r&&(a=Array.prototype.slice.call(arguments,0),r=e,t(e),t("always"))}}var o,r="pending",i={resolved:[],rejected:[],always:[]},a=[];return o=function(){return{done:e("resolved"),fail:e("rejected"),always:e("always")}},{promise:o,resolve:n("resolved"),reject:n("rejected")}},ieVersion=function(){var t,e=/MSIE (\d+\.\d+);/.test(navigator.userAgent),n=!!navigator.userAgent.match(/Trident\/7.0/),o=navigator.userAgent.indexOf("rv:11.0");return e&&(t=Number(RegExp.$1)),-1!==navigator.appVersion.indexOf("MSIE 10")&&(t=10),n&&-1!==o&&(t=11),t},loadJson=function(t,e,n){var o,r=ieVersion(),i=function(t){if("function"!=typeof n)throw new Error("loadJSON: "+t);n(t)},a=function(t){"function"==typeof e&&e(t)};r&&10>r?(o=new window.XDomainRequest,o.onerror=function(){i("XDomainRequest error")},o.onload=function(){a(window.JSON.parse(o.responseText))},o.open("GET",t),o.send()):window.XMLHttpRequest!==undefined?(o=new window.XMLHttpRequest,o.open("GET",t,!0),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?a(window.JSON.parse(o.responseText)):i(o.status))},o.send()):i("No appropriate method for cross-domain request!")},dcApi=function(t,e){return function(n,o){var r,i,a,s;return r={contestSignups:{},eventSignups:undefined,eventContests:undefined},i=function(){var r=t(),i=o+"eventinfo/"+n.toString()+"/contests";return e(i,function(t){for(var e={},n=t.length;n--;)e[t[n].id]=e[t[n].name]=t[n];r.resolve(e)},function(t){r.reject("Unable to load contests list!\nFailed to load "+i+"\n"+t)}),r.promise()},a=function(n,a){var s=t();return r.eventContests===undefined&&(r.eventContests=i()),r.eventContests.done(function(t){if(t[n]===undefined)return void s.reject("No such contest: "+n);var r=o+"eventinfo/signups/"+t[n].id+"/"+a;e(r,function(t){for(var e,n=t.length;n--;)t[n].city=t[n].cityAndState,t[n].partnerName&&(e=t[n].partnerName.replace(/ +(?= )/g,"").split(" "),t[n].parnterFirstName=e[0],t[n].parnterLastName=e[1]||"");s.resolve(t)},function(t){s.reject("Unable to load contest signups!\nFailed to load "+r+"\n"+t)})}),r.eventContests.fail(function(t){s.reject(t)}),s.promise()},s=function(){var r=t(),i=o+"eventinfo/"+n.toString()+"/signups";return e(i,function(t){for(var e,n=t.length;n--;)e=t[n].participantName.replace(/ +(?= )/g,"").split(" "),t[n].firstName=e[0],t[n].lastName=e[1]||"",t[n].city=t[n].cityAndState;r.resolve(t)},function(t){r.reject("Unable to load event signups!\nFailed to load "+i+"\n"+t)}),r.promise()},{getContestSignups:function(t,e,n){r.contestSignups[t]===undefined&&(r.contestSignups[t]={}),r.contestSignups[t][e]===undefined&&(r.contestSignups[t][e]=a(t,e)),r.contestSignups[t][e].done(function(t){"function"==typeof n&&n(t)}),r.contestSignups[t][e].fail(function(t){throw new Error("API Error: can't get contest signups!\n "+t)})},getEventSignups:function(t){r.eventSignups===undefined&&(r.eventSignups=s()),r.eventSignups.done(function(e){"function"==typeof t&&t(e)}),r.eventSignups.fail(function(t){throw new Error("API Error: can't get event signups!\n"+t)})}}}}(defer,loadJson),formatData=function(t,e){for(var n="",o=[],r=t.length;r--;)o.unshift(t[r].lastName+" "+t[r].firstName),t[r].city&&(o[0]=o[0]+", "+t[r].city),(t[r].parnterLastName||t[r].parnterFirstName)&&(o[0]=o[0]+" â€“ "+t[r].parnterLastName+" "+t[r].parnterFirstName,t[r].partnerCity&&(o[0]=o[0]+", "+t[r].partnerCity)),e&&(o[0]=e(o[0]));return o.length&&(n="<ol>\n<li>"+o.join("</li>\n<li>")+"</li>\n</ol>"),n},dcevent=function(dcApi,formatData){var id,contest,select,formatHook,formatHookFunc,globalFormatHookContainer=document.querySelector("script[data-format-hook]"),globalFormatHookFunc,eventsApi={},apiBaseUrl="https://danceconvention.net/eventdirector/rest/",apiUrlContainer=document.querySelector("script[data-dcevent-api]"),containers=document.querySelectorAll("[data-dcevent]"),i=containers.length,output=function(t,e){return function(n){t.innerHTML=formatData(n,e)}};for(apiUrlContainer&&(apiBaseUrl=apiUrlContainer.getAttribute("data-dcevent-api")),globalFormatHookContainer&&(globalFormatHookFunc=eval(globalFormatHookContainer.getAttribute("data-format-hook")));i--;)id=containers[i].getAttribute("data-dcevent"),id&&(contest=containers[i].getAttribute("data-contest"),select=containers[i].getAttribute("data-select"),formatHook=containers[i].getAttribute("data-format-hook"),formatHookFunc=formatHook?eval(formatHook):globalFormatHookFunc?globalFormatHookFunc:undefined,eventsApi[id]||(eventsApi[id]=dcApi(id,apiBaseUrl)),contest&&select&&eventsApi[id].getContestSignups(contest,select,output(containers[i],formatHookFunc)),contest||"signups"!==select||eventsApi[id].getEventSignups(output(containers[i],formatHookFunc)));window.DCevent={api:function(t,e){return e===undefined&&(e=apiBaseUrl),dcApi(t,e)},version:"0.0.1",apiBaseUrl:apiBaseUrl}}(dcApi,formatData)}(window,document)}();