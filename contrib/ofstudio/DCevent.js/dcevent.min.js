/**
     * DCEvent.js - Browser-side implementation of danceconvention.net API
     *
     * http://danceconvention.net
     * https://github.com/danceconvention/dcnet-public
     * Source: https://github.com/ofstudio/DCevent.js
     *
     * Compatibility:
     *
     *  All modern browsers including Internet Explorer 10 and up
     * (Internet Explorer 8 and 9 will work only if your site runs over https
     * due to restrictions in CORS implementation in IE8 and IE9)
     *
     * Copyright (c) 2014-2018 Oleg Fomin <ofstudio@gmail.com>
     * Released under the MIT license
     *
     * @author Oleg Fomin <ofstudio@gmail.com>
     * @version 0.0.3
     */

!function(){var defer,ieVersion,loadJson,dcApi,formatData,dcevent;!function(window,document,undefined){"use strict";defer=function(){function t(t){for(var n;i[t].length;)n=i[t].shift(),"function"==typeof n&&n.apply(n,a)}function n(n){return function(e){return i[n].push(e),"pending"!==r&&(r===n&&t(n),"always"===n&&t("always")),o()}}function e(n){return function(){"pending"===r&&(a=Array.prototype.slice.call(arguments,0),r=n,t(n),t("always"))}}var o,r="pending",i={resolved:[],rejected:[],always:[]},a=[];return o=function(){return{done:n("resolved"),fail:n("rejected"),always:n("always")}},{promise:o,resolve:e("resolved"),reject:e("rejected")}},ieVersion=function(){var t,n=/MSIE (\d+\.\d+);/.test(navigator.userAgent),e=!!navigator.userAgent.match(/Trident\/7.0/),o=navigator.userAgent.indexOf("rv:11.0");return n&&(t=Number(RegExp.$1)),-1!==navigator.appVersion.indexOf("MSIE 10")&&(t=10),e&&-1!==o&&(t=11),t},loadJson=function(t,n,e){var o,r=ieVersion(),i=function(t){if("function"!=typeof e)throw new Error("loadJSON: "+t);e(t)},a=function(t){"function"==typeof n&&n(t)};r&&10>r?(o=new window.XDomainRequest,o.onerror=function(){i("XDomainRequest error")},o.onload=function(){a(window.JSON.parse(o.responseText))},o.open("GET",t),o.send()):window.XMLHttpRequest!==undefined?(o=new window.XMLHttpRequest,o.open("GET",t,!0),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?a(window.JSON.parse(o.responseText)):i(o.status))},o.send()):i("No appropriate method for cross-domain request!")},dcApi=function(t,n){return function(e,o,r){var i,a,s,c;return r=r?"?lang="+r:"",i={contestSignups:{},eventSignups:undefined,eventContests:undefined},a=function(){var i=t(),a=o+"eventinfo/"+e.toString()+"/contests"+r;return n(a,function(t){for(var n={},e=t.length;e--;)n[t[e].id]=n[t[e].name]=t[e];i.resolve(n)},function(t){i.reject("Unable to load contests list!\nFailed to load "+a+"\n"+t)}),i.promise()},s=function(e,s){var c=t();return i.eventContests===undefined&&(i.eventContests=a()),i.eventContests.done(function(t){if(t[e]===undefined)return void c.reject("No such contest: "+e);var i=o+"eventinfo/signups/"+t[e].id+"/"+s+r;n(i,function(t){for(var n,e=t.length;e--;)t[e].city=t[e].cityAndState,t[e].partnerName&&(n=t[e].partnerName.replace(/ +(?= )/g,"").split(" "),t[e].parnterFirstName=n[0],t[e].parnterLastName=n[1]||"");c.resolve(t)},function(t){c.reject("Unable to load contest signups!\nFailed to load "+i+"\n"+t)})}),i.eventContests.fail(function(t){c.reject(t)}),c.promise()},c=function(){var i=t(),a=o+"eventinfo/"+e.toString()+"/signups"+r;return n(a,function(t){for(var n,e=t.length;e--;)n=t[e].participantName.replace(/ +(?= )/g,"").split(" "),t[e].firstName=n[0],t[e].lastName=n[1]||"",t[e].city=t[e].cityAndState;i.resolve(t)},function(t){i.reject("Unable to load event signups!\nFailed to load "+a+"\n"+t)}),i.promise()},{getContestSignups:function(t,n,e){i.contestSignups[t]===undefined&&(i.contestSignups[t]={}),i.contestSignups[t][n]===undefined&&(i.contestSignups[t][n]=s(t,n)),i.contestSignups[t][n].done(function(t){"function"==typeof e&&e(t)}),i.contestSignups[t][n].fail(function(t){throw new Error("API Error: can't get contest signups!\n "+t)})},getEventSignups:function(t){i.eventSignups===undefined&&(i.eventSignups=c()),i.eventSignups.done(function(n){"function"==typeof t&&t(n)}),i.eventSignups.fail(function(t){throw new Error("API Error: can't get event signups!\n"+t)})}}}}(defer,loadJson),formatData=function(t,n){for(var e="",o=[],r=t.length;r--;)o.unshift(t[r].lastName+" "+t[r].firstName),t[r].city&&(o[0]=o[0]+", "+t[r].city),(t[r].parnterLastName||t[r].parnterFirstName)&&(o[0]=o[0]+" â€“ "+t[r].parnterLastName+" "+t[r].parnterFirstName,t[r].partnerCity&&(o[0]=o[0]+", "+t[r].partnerCity)),n&&(o[0]=n(o[0]));return o.length&&(e="<ol>\n<li>"+o.join("</li>\n<li>")+"</li>\n</ol>"),e},dcevent=function(dcApi,formatData){var id,contest,select,formatHook,formatHookFunc,globalFormatHookContainer=document.querySelector("script[data-format-hook]"),globalFormatHookFunc,eventsApi={},apiBaseUrl="https://danceconvention.net/eventdirector/rest/",lang=null,langContainer=document.querySelector("script[data-dcevent-lang]"),apiUrlContainer=document.querySelector("script[data-dcevent-api]"),containers=document.querySelectorAll("[data-dcevent]"),i=containers.length,output=function(t,n){return function(e){t.innerHTML=formatData(e,n)}};for(apiUrlContainer&&(apiBaseUrl=apiUrlContainer.getAttribute("data-dcevent-api")),langContainer&&(lang=langContainer.getAttribute("data-dcevent-lang")),globalFormatHookContainer&&(globalFormatHookFunc=eval(globalFormatHookContainer.getAttribute("data-format-hook")));i--;)id=containers[i].getAttribute("data-dcevent"),id&&(contest=containers[i].getAttribute("data-contest"),select=containers[i].getAttribute("data-select"),formatHook=containers[i].getAttribute("data-format-hook"),formatHookFunc=formatHook?eval(formatHook):globalFormatHookFunc?globalFormatHookFunc:undefined,eventsApi[id]||(eventsApi[id]=dcApi(id,apiBaseUrl,lang)),contest&&select&&eventsApi[id].getContestSignups(contest,select,output(containers[i],formatHookFunc)),contest||"signups"!==select||eventsApi[id].getEventSignups(output(containers[i],formatHookFunc)));window.DCevent={api:function(t,n){return n===undefined&&(n=apiBaseUrl),dcApi(t,n)},version:"0.0.3",apiBaseUrl:apiBaseUrl}}(dcApi,formatData)}(window,document)}();